@isTest
public class B2BHandleInvoiceStripeEventsTest {
    
    @isTest static void testDeserializeInvoice_created() {

        List<String> requestBodies = new List<String>();
        String requestBody = '{"type":"invoice.created","request":{"idempotency_key":"0b04553f-3f7d-4880-b99c-ce6d3c4bcc0c","id":"req_UCMOt0xsSx9oi6"},"pending_webhooks":1,"livemode":false,"data":{"object":{"webhooks_delivered_at":null,"transfer_data":null,"total_tax_amounts":[],"total_excluding_tax":0,"total_discount_amounts":[],"total":0,"test_clock":null,"tax":null,"subtotal_excluding_tax":0,"subtotal":0,"subscription_details":{"metadata":null},"subscription":null,"status_transitions":{"voided_at":null,"paid_at":null,"marked_uncollectible_at":null,"finalized_at":null},"status":"draft","statement_descriptor":null,"starting_balance":0,"shipping_details":null,"shipping_cost":null,"rendering_options":null,"rendering":{"pdf":{"page_size":"auto"},"amount_tax_display":null},"receipt_number":null,"quote":null,"pre_payment_credit_notes_amount":0,"post_payment_credit_notes_amount":0,"period_start":1724953499,"period_end":1724953499,"payment_settings":{"payment_method_types":null,"payment_method_options":null,"default_mandate":null},"payment_intent":null,"paid_out_of_band":false,"paid":false,"on_behalf_of":null,"number":null,"next_payment_attempt":null,"metadata":{"salesforce_order_id":"801cX000008oRRtQAM"},"livemode":false,"lines":{"url":"/v1/invoices/in_1PtCP1FkggLOPOs8urwBPiPW/lines","total_count":0,"has_more":false,"data":[],"object":"list"},"latest_revision":null,"last_finalization_error":null,"issuer":{"type":"self"},"invoice_pdf":null,"hosted_invoice_url":null,"from_invoice":null,"footer":null,"ending_balance":null,"effective_at":null,"due_date":null,"discounts":[],"discount":null,"description":null,"default_tax_rates":[],"default_source":null,"default_payment_method":null,"customer_tax_ids":[],"customer_tax_exempt":"none","customer_shipping":null,"customer_phone":"123456778","customer_name":"Account Test","customer_email":"poojitha.anthati+43@stackintelligence.com","customer_address":null,"customer":"cus_Q2NwxM4cWSm8ra","custom_fields":null,"currency":"usd","created":1724953499,"collection_method":"send_invoice","charge":null,"billing_reason":"manual","automatically_finalizes_at":null,"automatic_tax":{"status":null,"liability":null,"enabled":false},"auto_advance":false,"attempted":false,"attempt_count":0,"application_fee_amount":null,"application":null,"amount_shipping":0,"amount_remaining":0,"amount_paid":0,"amount_due":0,"account_tax_ids":null,"account_name":"Daniel Owens","account_country":"US","object":"invoice","id":"in_1PtCP1FkggLOPOs8urwBPiPW"}},"created":1724953499,"api_version":"2022-11-15","object":"event","id":"evt_1PtCP2FkggLOPOs82R22uEBQ"}';
        requestBodies.add(requestBody);

        List<B2BHandleInvoiceStripeEvents.Results> result;
        Test.StartTest();
        result = B2BHandleInvoiceStripeEvents.deserializeInvoice(requestBodies);
        Test.StopTest();
    }

    @isTest static void testDeserializeInvoice_paid() {

        List<String> requestBodies = new List<String>();
        String requestBody = '{"type":"invoice.paid","request":{"idempotency_key":"5cf9c114-5dba-41c8-9b27-f9ca4910fbb1","id":null},"pending_webhooks":1,"livemode":false,"data":{"object":{"webhooks_delivered_at":1724947805,"transfer_data":null,"total_tax_amounts":[],"total_excluding_tax":330, "discount":300, "description":"Test", "tax":100, "total_discount_amounts":[],"total":330,"test_clock":null,"tax":null,"subtotal_excluding_tax":330,"subtotal":330,"subscription_details":{"metadata":null},"subscription":null,"status_transitions":{"voided_at":null,"paid_at":1725395404,"marked_uncollectible_at":null,"finalized_at":1724951571},"status":"paid","statement_descriptor":null,"starting_balance":0,"shipping_details":null,"shipping_cost":null,"rendering_options":null,"rendering":{"pdf":{"page_size":"letter"},"amount_tax_display":null},"receipt_number":null,"quote":null,"pre_payment_credit_notes_amount":0,"post_payment_credit_notes_amount":0,"period_start":1724947805,"period_end":1724947805,"payment_settings":{"payment_method_types":null,"payment_method_options":null,"default_mandate":null},"payment_intent":"pi_3PtBtwFkggLOPOs81P32eocT","paid_out_of_band":false,"paid":true,"on_behalf_of":null,"number":"93746CC1-0074","next_payment_attempt":null,"metadata":{"salesforce_order_id":"801cX000008oRRtQAM"},"livemode":false,"lines":{"url":"/v1/invoices/in_1PtAvBFkggLOPOs8ziLKjm1X/lines","total_count":1,"has_more":false,"data":[{"unit_amount_excluding_tax":"330","type":"invoiceitem","tax_rates":[],"tax_amounts":[],"subscription":null,"quantity":1,"proration_details":{"credited_items":null},"proration":false,"price":{"unit_amount_decimal":"330","unit_amount":330,"type":"one_time","transform_quantity":null,"tiers_mode":null,"tax_behavior":"unspecified","recurring":null,"product":"prod_PpF4d1FoGdKqDW","nickname":null,"metadata":{},"lookup_key":null,"livemode":false,"custom_unit_amount":null,"currency":"usd","created":1711700072,"billing_scheme":"per_unit","active":true,"object":"price","id":"price_1Ozaa4FkggLOPOs8vj30M5nS"},"plan":null,"period":{"start":1724947812,"end":1724947812},"metadata":{},"livemode":false,"invoice_item":"ii_1PtAvIFkggLOPOs8EeHxtF4h","invoice":"in_1PtAvBFkggLOPOs8ziLKjm1X","discounts":[],"discountable":true,"discount_amounts":[],"description":"Mars bar (per 1)","currency":"usd","amount_excluding_tax":330,"amount":330,"object":"line_item","id":"il_1PtAvIFkggLOPOs8T05HSGAq"}],"object":"list"},"latest_revision":null,"last_finalization_error":null,"issuer":{"type":"self"},"invoice_pdf":"https://pay.stripe.com/invoice/acct_1OyWGfFkggLOPOs8/test_YWNjdF8xT3lXR2ZGa2dnTE9QT3M4LF9Ra2dIanJRZGFUaU9kd0VwaFlnSm55QW1CZjhHVVdhLDExNTkzNjIwNQ0200VNpiGWSA/pdf?s=ap","hosted_invoice_url":"https://invoice.stripe.com/i/acct_1OyWGfFkggLOPOs8/test_YWNjdF8xT3lXR2ZGa2dnTE9QT3M4LF9Ra2dIanJRZGFUaU9kd0VwaFlnSm55QW1CZjhHVVdhLDExNTkzNjIwNQ0200VNpiGWSA?s=ap","from_invoice":null,"footer":null,"ending_balance":0,"effective_at":1724951571,"due_date":1727543571,"discounts":[],"discount":null,"description":null,"default_tax_rates":[],"default_source":null,"default_payment_method":null,"customer_tax_ids":[],"customer_tax_exempt":"none","customer_shipping":null,"customer_phone":null,"customer_name":"Account Test","customer_email":"poojitha.anthati+43@stackintelligence.com","customer_address":null,"customer":"cus_Q2NwxM4cWSm8ra","custom_fields":null,"currency":"usd","created":1724947805,"collection_method":"send_invoice","charge":"ch_3PtBtwFkggLOPOs81jxynrye","billing_reason":"manual","automatically_finalizes_at":null,"automatic_tax":{"status":null,"liability":null,"enabled":false},"auto_advance":false,"attempted":true,"attempt_count":1,"application_fee_amount":null,"application":null,"amount_shipping":0,"amount_remaining":0,"amount_paid":330,"amount_due":330,"account_tax_ids":null,"account_name":"Daniel Owens","account_country":"US","object":"invoice","id":"in_1PtAvBFkggLOPOs8ziLKjm1X"}},"created":1725395404,"api_version":"2022-11-15","object":"event","id":"evt_1Pv3MXFkggLOPOs8woyoDWbl"}';
        requestBodies.add(requestBody);

        List<B2BHandleInvoiceStripeEvents.Results> result;
        Test.StartTest();
        result = B2BHandleInvoiceStripeEvents.deserializeInvoice(requestBodies);
        Test.StopTest();
    }
}